# 专用服务器激进优化配置
# 适用于: 4核3GHz + 7.5GB内存的专用小智ESP32服务器
# 优化目标: 支持3-4台设备稳定并发，消除卡顿现象

# 基础配置
read_config_from_api: true
api_base_url: "http://localhost:8002"

# ASR配置 - 激进优化版本
asr:
  provider: "SenseVoiceStream"
  # 专用服务器可以支持更多并发会话
  max_concurrent_sessions: 3
  # 减小chunk_size提升响应速度
  chunk_size: 384
  # 音频缓冲区优化
  audio_buffer_size: 4096
  # 预加载模型，消除冷启动
  preload_model: true
  # 模型池配置 - 专用服务器可以加载更多实例
  model_pool:
    max_instances: 3
    min_instances: 2
    # 预热所有实例
    warmup_instances: true
  # 线程池配置 - 专用服务器可以使用更多线程
  thread_pool:
    max_workers: 3
    # 预创建线程
    core_workers: 2
  # 内存管理
  memory_management:
    # 专用服务器可以预留更多内存
    reserved_memory_gb: 3.0
    # 启用内存池
    enable_memory_pool: true
    # 垃圾回收优化
    gc_threshold: 100
  # VAD配置优化
  vad:
    # 更敏感的语音检测
    speech_threshold: 0.3
    # 减少单段最大时间，提升响应
    max_single_segment_time: 12000
    # 减少静音检测时间
    max_end_silence_time: 800
    # 最小语音段长度
    min_speech_duration: 300
  # 性能优化
  performance:
    # 启用CUDA加速（如果可用）
    enable_cuda: false
    # CPU亲和性 - 绑定到前3个核心
    cpu_affinity: [0, 1, 2]
    # 优先级设置
    process_priority: "high"
    # 启用批处理
    enable_batch_processing: true
    batch_size: 2

# LLM配置 - 优化版本
llm:
  # 专用线程池
  thread_pool:
    max_workers: 3
    core_workers: 2
  # 连接池优化
  connection_pool:
    max_connections: 50
    # 专用服务器可以保持更多连接
    keep_alive_connections: 20
  # 超时配置
  timeout:
    connect_timeout: 10
    read_timeout: 30
    total_timeout: 45
  # 重试配置
  retry:
    max_retries: 2
    backoff_factor: 1.5

# TTS配置 - 优化版本
tts:
  # 专用线程池
  thread_pool:
    max_workers: 2
    core_workers: 1
  # 音频缓存
  audio_cache:
    enable: true
    max_size: 100
    ttl: 3600

# WebSocket配置 - 专用服务器可以支持更多连接
websocket:
  # 增加最大连接数
  max_connections: 8
  # 每IP最大并发连接数
  max_concurrent_per_ip: 3
  # 连接超时
  connection_timeout: 300
  # 心跳配置
  heartbeat:
    interval: 30
    timeout: 10
  # 消息队列配置
  message_queue:
    max_size: 1000
    # 专用服务器可以使用更多内存
    max_memory_mb: 256
  # 缓冲区配置
  buffer:
    # 增大接收缓冲区
    receive_buffer_size: 65536
    # 增大发送缓冲区
    send_buffer_size: 65536

# 系统级优化配置
system:
  # 性能监控
  monitoring:
    enable_metrics: true
    metrics_interval: 5
    log_performance: true
    # 详细的性能日志
    detailed_logging: true
  # 日志配置
  logging:
    level: "INFO"
    # 专用服务器可以启用更详细的日志
    enable_debug: false
    # 日志轮转
    rotation:
      max_size: "100MB"
      backup_count: 5
  # 缓存配置
  cache:
    # 启用多级缓存
    enable_multi_level: true
    # 内存缓存大小
    memory_cache_size: 512
    # 磁盘缓存大小
    disk_cache_size: 1024
  # 数据库连接池
  database:
    pool_size: 10
    max_overflow: 20
    pool_timeout: 30
    pool_recycle: 3600
  # Redis配置
  redis:
    pool_size: 10
    max_connections: 50
    socket_timeout: 5
    socket_connect_timeout: 5

# 专用服务器特殊配置
dedicated_server:
  # 启用专用服务器模式
  enable: true
  # 资源预分配
  resource_preallocation:
    # 预分配内存
    memory_gb: 4.0
    # 预创建线程
    thread_count: 8
    # 预加载模型
    preload_models: true
  # 性能调优
  performance_tuning:
    # 禁用不必要的功能
    disable_unnecessary_features: true
    # 启用性能模式
    performance_mode: true
    # CPU调度优化
    cpu_scheduling: "performance"
    # 内存分配策略
    memory_allocation: "aggressive"
  # 监控和告警
  monitoring:
    # 启用资源监控
    enable_resource_monitoring: true
    # 监控间隔（秒）
    monitoring_interval: 10
    # 告警阈值
    alert_thresholds:
      cpu_usage: 85
      memory_usage: 80
      disk_usage: 85
      response_time: 2000
  # 自动优化
  auto_optimization:
    # 启用自动调优
    enable: true
    # 调优间隔（分钟）
    optimization_interval: 30
    # 自动垃圾回收
    auto_gc: true
    # 自动内存整理
    auto_memory_defrag: true

# 开发和调试配置（生产环境可关闭）
development:
  # 启用开发模式
  enable: false
  # 热重载
  hot_reload: false
  # 调试信息
  debug_info: false
  # 性能分析
  profiling: false